pipeline {
  agent any

  environment {
    IMAGE_NAME = 'sufibaba6629/sufiprofile-reactapp'
    IMAGE_TAG  = "${BUILD_NUMBER}"   // We'll tag using build number
  }

  stages {
    stage('Checkout') {
      steps {
        git branch: 'main', url: 'https://github.com/sufyanahmadkamboh/sample-react-app.git'
        sh 'ls -ltr'
      }
    }

    stage('Build & Push Docker Image') {
      steps {
        script {
          // Build Docker image
          def app = docker.build("${IMAGE_NAME}:${IMAGE_TAG}")

          // Push to Docker Hub using stored credentials
          docker.withRegistry('https://index.docker.io/v1/', 'dockerhub-credentials') {
            app.push()              // push build-tagged image
            app.push('latest')      // optional: also push "latest"
          }
        }
      }
    }
  }
}
